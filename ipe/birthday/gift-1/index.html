<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petualangan Ulang Tahun</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #fbcfe8 0%, #fef08a 50%, #bfdbfe 100%);
            background-attachment: fixed;
            color: #334155;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            overflow-y: hidden; 
        }
        .polaroid {
            background: linear-gradient(to bottom right, #fff1f2, #fefce8, #f0f9ff);
            padding: 1rem 1rem 2rem 1rem;
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.15), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            border-radius: 1rem;
            border: 6px solid white;
            transform: rotate(-2deg);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .polaroid:hover {
            transform: rotate(0deg) scale(1.02);
            box-shadow: 0 20px 30px -5px rgba(0, 0, 0, 0.2);
        }
        .image-placeholder {
            background: linear-gradient(45deg, #e2e8f0, #cbd5e1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            font-weight: bold;
            text-align: center;
            border-radius: 0.5rem;
        }
        .story-text-highlight {
            color: #9d174d;
            text-shadow: 1px 1px 1px rgba(255,255,255,0.5);
        }
        #bg-gallery {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 1; 
            opacity: 0.35;
            pointer-events: none;
            overflow: hidden;
        }
        .bg-img-item {
            position: absolute;
            object-fit: cover;
            border-radius: 0.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            background-color: white;
            border: 5px solid #ffffff;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 relative">

    <!-- Gallery Background (Z-index 1) -->
    <div id="bg-gallery"></div>

    <!-- Main Game UI (Z-index 10) -->
    <div id="game-container" class="max-w-md w-full mx-auto relative z-10">
        <div class="polaroid mb-6 relative">
            <div class="absolute -top-4 -right-4 text-4xl transform rotate-12">âœ¨</div>
            <div class="absolute -bottom-4 -left-4 text-4xl transform -rotate-12">ðŸŽ‰</div>
            
            <div id="image-container" class="w-full aspect-square mb-6 rounded-lg overflow-hidden relative shadow-inner border-2 border-pink-100 bg-white">
                <img id="scene-image" src="" alt="Scene Image" class="w-full h-full object-cover hidden">
                <div id="placeholder-text" class="absolute inset-0 image-placeholder text-sm px-6 flex flex-col gap-2">
                    <span class="text-3xl" id="placeholder-icon">ðŸ“·</span>
                    <span id="placeholder-filename">Memuat foto...</span>
                    <span id="placeholder-hint" class="text-xs font-normal opacity-80">(Mencoba variasi format file...)</span>
                </div>
            </div>
            
            <div class="px-2">
                <p id="scene-text" class="story-text-highlight text-lg leading-relaxed text-center font-bold min-h-[80px] flex items-center justify-center">
                    Menyiapkan memori...
                </p>
            </div>
        </div>

        <div id="choices-container" class="flex flex-col space-y-3">
            <!-- Buttons injected here -->
        </div>
    </div>

    <script>
        /**
         * 77 FOTO UNIK DARI HASIL UNGGAHAN
         */
        const backgroundPhotos = [
            "IMG_2671.jpg", "IMG_2692.jpg", "IMG_2707.jpg", "IMG_2708.jpg", "IMG_3941.jpg", 
            "IMG_3949.jpg", "IMG_3950.jpg", "IMG_4270.jpg", "IMG_4271.jpg", "IMG_4279.jpg", 
            "IMG_5158.jpg", "IMG_5160.jpg", "IMG_5751.jpg", "IMG_5753.jpg", "IMG_5767.jpg", 
            "IMG_5769.jpg", "IMG_5771.jpg", "IMG_5775.jpg", "IMG_5799.jpg", "IMG_5800.jpg", 
            "IMG_5803.jpg", "IMG_5847.jpg", "IMG_5851.jpg", "IMG_6284.jpg", "IMG_6306.jpg", 
            "IMG_6307.jpg", "IMG_6315.jpg", "IMG_6316.jpg", "IMG_7328.jpg", "IMG_7332.jpg", 
            "IMG_7400.jpg", "IMG_7466.jpg", "IMG_7468.jpg", "IMG_7469.jpg", "IMG_7488.jpg", 
            "IMG_7491.jpg", "IMG_7507.jpg", "0a1b98d0-88e8-4a2c-80c8-cd1af2f6f81b.jpg", 
            "0b30e914-5a47-4632-b338-cd41c3f3b7d1.jpg", "0e63f929-68b2-4f26-9ae8-64d408703bd6.jpg",
            "1c51c290-0d06-4827-a3e6-0b8edb37ab40.jpg", "1d0f032b-b1f7-48bc-972f-22d178ac85a2.jpg",
            "1e809e68-ec69-4091-913b-e805342342c1.jpg", "2c504ced-b605-4d62-93b2-b7482127b181.jpg",
            "2d3905a6-37d3-4bf2-a7a2-073eed7ca9dd.jpg", "5c514040-fdf5-421a-80b5-363b6fae652a.jpg",
            "6eeeb626-7dfc-40b8-a248-97c085b73606.jpg", "8e4a4ce2-c89d-42f5-b6e5-5a9e931bc9bd.jpg",
            "62cc68b7-8e37-4b08-ab4f-b826148744c2.jpg", "67fa67d0-4e20-4672-b81d-81d59c6972d0.jpg",
            "077ff3b7-a585-4eb1-b2ff-05325b9f5b79.jpg", "85e70a09-5df6-4f78-aaf4-62c719dea23c.jpg",
            "930ed0e7-3cdc-460c-89ff-3cda5d93d245.jpg", "970cd0da-d67c-4e61-a596-75b86350441d.jpg",
            "6510d24d-8f28-4fe4-8ca7-2fa289d23308.jpg", "7788fbf1-f01e-45e4-894e-6fcea25ade4e.jpg",
            "8389d909-45ae-4178-9c15-2f2275147415.jpg", "10829ac4-5bbc-4733-a2a0-4036219fba8b.jpg",
            "59883c71-855f-4028-a043-64158a342abb.jpg", "69324f5e-7f00-45f4-96c4-2981fafbcd74.jpg",
            "7651102b-6430-4e57-a7ed-918d846cdad2.jpg", "95746289-955c-4711-9416-0c22cfede4f9.jpg",
            "a9348dba-0213-4bf2-9531-fa915c6332e7.jpg", "ae2d4b1d-241e-496c-abff-47df980727c5.jpg",
            "b8a83a04-a7ee-4af5-b5e3-4b269ec3d0ca.jpg", "b25942ab-7cc0-4237-84cf-378397589d94.jpg",
            "C2C23ED4-80E4-409E-8E91-64521BC476BE.jpg", "d0c19ff2-27fb-4da4-9ed7-1dc7d32c1c1a.jpg",
            "e3581d96-0785-485f-8c09-07c2df631438.jpg", "e34723c9-fb66-4041-96f8-707e22dba9ab.jpg",
            "IMG_5285.jpg", "eb4c7d69-6d10-4cdb-8fb7-59c82149ebd5.jpg", "f4d16661-005f-42ab-b8f7-af5dfc77c5d1.jpg", 
            "F82808F8-4E25-4F2A-9651-F7FD53C02032.jpg", "fcb35894-ba72-45f6-8909-5a6edd2a8f1a.jpg", 
            "IMG_4982.jpg", "IMG_5007.jpg"
        ];

        const mainPhotos = backgroundPhotos.slice(0, 20);

        const storyData = [
            { id: 1, photo: mainPhotos[0], text: "Selamat ulang tahun sayang! Aku bikin galeri memori mini buat kita. Coba lihat foto pertama ini, senyum kamu manis banget.", choices: [{ text: "Lanjut dong!", next: 2 }] },
            { id: 2, photo: mainPhotos[1], text: "Tuh kan, emang foto ini bagus. Kalau yang ini gimana? Pas kamu lagi jalan-jalan. Kamu kelihatan cakep di sini.", choices: [{ text: "Apalagi nih?", next: 3 }] },
            { id: 3, photo: mainPhotos[2], text: "Pas rebahan natural aja tetep cantik. Kamu suka nggak hasil jepretanku yang ini?", choices: [{ text: "Next!", next: 4 }] },
            { id: 4, photo: mainPhotos[3], text: "Kalo foto yang ini? Ini salah satu favoritku sih, senyumnya nular banget.", choices: [{ text: "Wah, terus?", next: 5 }] },
            { id: 5, photo: mainPhotos[4], text: "Oke, mari kita lihat foto yang LEBIH 'estetik'. Coba lihat muka konyol ini.", choices: [{ text: "Gas lanjut!", next: 6 }] },
            { id: 6, photo: mainPhotos[5], text: "Nah kalau foto ini, masa kamu nggak suka juga? Ini kan pas kamu lagi manis senyum.", choices: [{ text: "Lagi dong!", next: 7 }] },
            { id: 7, photo: mainPhotos[6], text: "Lanjut! Ini pas kita lagi jajan bareng. Kamu kangen nggak sih hari itu?", choices: [{ text: "Selanjutnya...", next: 8 }] },
            { id: 8, photo: mainPhotos[7], text: "Lucu gitu. Coba lihat yang ini, pas kita foto bareng kucing. Sama-sama gemes!", choices: [{ text: "Terus terus?", next: 9 }] },
            { id: 9, photo: mainPhotos[8], text: "Coba lihat gaya jari konyol kita ini. Ini beneran memori yang nggak terlupakan!", choices: [{ text: "Hahaha, next!", next: 10 }] },
            { id: 10, photo: mainPhotos[9], text: "Yay! Oke, mari kita lihat foto yang agak sweet. Lihat kamu meluk boneka gede ini.", choices: [{ text: "Lihat yang lain", next: 11 }] },
            { id: 11, photo: mainPhotos[10], text: "Kalau foto kamu pas lagi fokus, aku suka banget lihatnya. Ini candid terbaik!", choices: [{ text: "Lanjut!", next: 12 }] },
            { id: 12, photo: mainPhotos[11], text: "Yang penting momennya. Coba lihat foto kita pas lagi capek di motor tapi happy ini.", choices: [{ text: "Next lagi dong", next: 13 }] },
            { id: 13, photo: mainPhotos[12], text: "Mantap! Lanjut ke foto kamu yang paling sering aku pandangin kalau lagi kangen.", choices: [{ text: "Aww, apalagi?", next: 14 }] },
            { id: 14, photo: mainPhotos[13], text: "Ini ada foto derp kamu. Bukti kalau kita bisa konyol bareng-bareng terus.", choices: [{ text: "Lanjut!", next: 15 }] },
            { id: 15, photo: mainPhotos[14], text: "Natural itu namanya! Coba lihat foto natural kita yang ini. Bagus kan?", choices: [{ text: "Okee next!", next: 16 }] },
            { id: 16, photo: mainPhotos[15], text: "Hampir selesai nih galerinya. Ini foto berdua kita yang menurutku paling dapet banget chemistry-nya.", choices: [{ text: "Lanjut!", next: 17 }] },
            { id: 17, photo: mainPhotos[16], text: "Nggak usah malu, emang cakep kok! Coba lihat satu lagi foto candid kamu ini.", choices: [{ text: "Terus?", next: 18 }] },
            { id: 18, photo: mainPhotos[17], text: "Ini foto terakhir buat hukuman. Aib kita berdua! Hahaha.", choices: [{ text: "Ampun, next!", next: 19 }] },
            { id: 19, photo: mainPhotos[18], text: "Akhirnya sampai di foto favorit utamaku. Semua perjalanan kita ada di sini.", choices: [{ text: "Lihat yang terakhir!", next: 20 }] },
            { id: 20, photo: mainPhotos[19], text: "Happy Birthday Sayang! Makasih udah nemenin bikin banyak momen bagus. Ini adalah akhir dari galeri mini kita. I love you! â¤ï¸", choices: [] }
        ];

        const imageEl = document.getElementById('scene-image');
        const placeholderText = document.getElementById('placeholder-text');
        const filenameEl = document.getElementById('placeholder-filename');
        const hintEl = document.getElementById('placeholder-hint');
        const iconEl = document.getElementById('placeholder-icon');
        const textEl = document.getElementById('scene-text');
        const choicesContainer = document.getElementById('choices-container');

        // Fungsi Auto-Fallback untuk menetralisir Case Sensitivity ekstensi file
        function generateFallbacks(filename) {
            if (!filename) return [];
            const base = filename.substring(0, filename.lastIndexOf('.'));
            return [
                filename, 
                base + '.JPG', 
                base + '.jpeg', 
                base + '.JPEG', 
                base + '.png',
                base + '.PNG'
            ];
        }

        function renderScene(sceneId) {
            const scene = storyData.find(s => s.id === sceneId);
            if (!scene) return;

            textEl.innerText = scene.text;
            imageEl.classList.add('hidden');
            placeholderText.classList.remove('hidden');
            iconEl.innerText = "â³";
            filenameEl.innerText = "Memuat: " + scene.photo;
            hintEl.innerText = "Mencari file di perangkat Anda...";
            hintEl.className = "text-xs font-normal opacity-80 text-blue-600";

            if (!scene.photo) {
                iconEl.innerText = "âš ï¸";
                filenameEl.innerText = "Tidak ada referensi foto";
                hintEl.innerText = "";
            } else {
                const fallbacks = generateFallbacks(scene.photo);
                const uniqueFallbacks = [...new Set(fallbacks)];
                let attemptIndex = 0;

                function attemptLoad() {
                    if (attemptIndex >= uniqueFallbacks.length) {
                        iconEl.innerText = "âŒ";
                        filenameEl.innerText = `Error: ${scene.photo} tidak ditemukan.`;
                        hintEl.innerText = "Pastikan file fisik foto berada di TEPAT folder yang sama dengan file HTML ini.";
                        hintEl.className = "text-xs font-bold text-red-600 mt-2 bg-red-100 p-2 rounded";
                        return;
                    }

                    const imgLoad = new Image();
                    imgLoad.onload = function() {
                        imageEl.src = uniqueFallbacks[attemptIndex];
                        imageEl.classList.remove('hidden');
                        placeholderText.classList.add('hidden');
                    };
                    imgLoad.onerror = function() {
                        attemptIndex++;
                        attemptLoad(); 
                    };
                    imgLoad.src = uniqueFallbacks[attemptIndex];
                }
                
                attemptLoad();
            }

            choicesContainer.innerHTML = '';
            scene.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = "w-full bg-white hover:bg-pink-50 text-pink-700 font-bold py-3 px-6 rounded-xl shadow-md transition-all duration-200 transform hover:-translate-y-0.5 active:scale-95 text-center border-b-4 border-pink-200 active:border-b-0";
                btn.innerText = choice.text;
                btn.onclick = () => renderScene(choice.next);
                choicesContainer.appendChild(btn);
            });
        }

        /**
         * PERBAIKAN VISIBILITAS GRID LATAR BELAKANG
         * - Ukuran dikurangi (180px - 320px) agar foto tidak menumpuk buta.
         * - Jitter (acak posisi) dikurangi agar foto tetap terdistribusi teratur.
         */
        function renderBackgroundGallery() {
            const bgContainer = document.getElementById('bg-gallery');
            bgContainer.innerHTML = ''; 
            
            const totalPhotos = backgroundPhotos.length;
            if(totalPhotos === 0) return;

            const columns = Math.ceil(Math.sqrt(totalPhotos)); 
            const rows = Math.ceil(totalPhotos / columns);   

            for (let i = 0; i < totalPhotos; i++) {
                let imgEl = document.createElement('img');
                
                const originalSrc = backgroundPhotos[i];
                const fallbacks = generateFallbacks(originalSrc);
                const uniqueFallbacks = [...new Set(fallbacks)];
                let attemptIndex = 0;

                function attemptBgLoad() {
                    if (attemptIndex >= uniqueFallbacks.length) {
                        imgEl.style.backgroundColor = '#f1f5f9';
                        imgEl.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'; 
                        return;
                    }
                    imgEl.src = uniqueFallbacks[attemptIndex];
                }

                imgEl.onerror = function() {
                    attemptIndex++;
                    attemptBgLoad();
                };
                
                attemptBgLoad();

                imgEl.className = 'bg-img-item';
                imgEl.loading = 'lazy';

                const col = i % columns;
                const row = Math.floor(i / columns);
                
                // Distribusi diseimbangkan, tidak melebar terlalu jauh ke luar layar
                const startRatio = -5;
                const endRatio = 105;
                const range = endRatio - startRatio;
                
                const baseLeft = startRatio + (col / Math.max(1, columns - 1)) * range;
                const baseTop = startRatio + (row / Math.max(1, rows - 1)) * range;
                
                // Deviasi posisi diperkecil agar tidak menimpa foto tetangganya secara fatal
                const jitterX = (Math.random() * 12) - 6; 
                const jitterY = (Math.random() * 12) - 6; 
                
                // SKALA DIKECILKAN: Memberi ruang bagi foto untuk terlihat sebagai entitas individu
                const size = Math.floor(Math.random() * (320 - 180 + 1)) + 180; 
                const rotation = Math.floor(Math.random() * 60) - 30; 

                imgEl.style.width = `${size}px`;
                imgEl.style.height = `${size}px`;
                
                imgEl.style.left = `${baseLeft + jitterX}%`;
                imgEl.style.top = `${baseTop + jitterY}%`;
                imgEl.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
                imgEl.style.zIndex = 1;

                bgContainer.appendChild(imgEl);
            }
        }

        window.onload = () => {
            renderBackgroundGallery();
            renderScene(1);
        };
    </script>
</body>
</html>
